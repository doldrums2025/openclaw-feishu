# Bitable 工具快速测试

**测试时间**: 约 5 分钟

---

## 快速开始

### 方法 1: 使用测试脚本 (推荐) ✨

**步骤**:

1. **设置环境变量** (如果之前已配置可跳过)

   ```powershell
   # Windows PowerShell
   $env:FEISHU_APP_ID="cli_a9f41ff7dc78dcd2"
   $env:FEISHU_APP_SECRET="SRIUo25Wmm5c227GSbqkOf57wIcpxkJS"
   $env:FEISHU_TEST_BITABLE_APP_TOKEN="bascnxxx"  # 需要替换为您的表格 token
   ```

2. **运行测试**

   ```bash
   node test-bitable.mjs
   ```

3. **查看结果**
   - 控制台会显示每个测试的结果
   - 详细结果保存在 `bitable-test-results.json`

**预期输出**:
```
✅ 飞书客户端初始化成功

🔍 测试: 测试 1: 列出数据表
   📊 数据表数量: 1
   📋 第一个表格: 数据表 (tblXXX)
   ✅ 通过

🔍 测试: 测试 2: 列出字段
   📊 字段数量: 3
   📋 字段示例: 文本 (type: 1)
   ✅ 通过

...

📊 测试结果总结
✅ 通过: 10
❌ 失败: 0
```

---

## 测试内容

测试脚本会自动执行以下 10 个测试:

1. ✅ 列出数据表
2. ✅ 列出字段
3. ✅ 创建字段 (文本类型)
4. ✅ 创建单条记录
5. ✅ 查询记录
6. ✅ 搜索记录
7. ✅ 批量创建记录 (3 条)
8. ✅ 更新记录
9. ✅ 删除记录
10. ✅ 创建数据表

---

## 方法 2: 通过 OpenClaw 测试

如果您已配置 OpenClaw，可以在飞书中直接测试:

1. 在飞书中 @ 您的机器人
2. 发送消息:

   ```
   帮我列出多维表格的所有数据表
   app_token: bascnxxx
   ```

3. 机器人会自动调用 `feishu_bitable` 工具

---

## 如何获取 app_token

1. 打开您的飞书多维表格
2. 查看浏览器 URL:
   ```
   https://xxx.feishu.cn/base/bascnABC123?table=tblXXX
                             ^^^^^^^^^^^
                             这就是 app_token
   ```
3. 设置环境变量:
   ```powershell
   $env:FEISHU_TEST_BITABLE_APP_TOKEN="bascnABC123"
   ```

---

## 常见问题

### Q1: 权限错误 (99991663)

**原因**: 未申请或未审批 `bitable:app` 权限

**解决**:
1. 访问 [飞书开放平台](https://open.feishu.cn/app)
2. 进入您的应用 → 权限管理
3. 申请 `bitable:app` 权限
4. 等待管理员审批 (通常几分钟)

---

### Q2: Token 无效 (99991404)

**原因**: app_token 错误或表格不存在

**解决**:
1. 检查 token 格式 (应为 `bascnXXX`)
2. 确认多维表格存在
3. 确认应用有访问该表格的权限

---

### Q3: 字段不存在 (1254044)

**原因**: 使用了不存在的字段名称

**解决**:
1. 先运行 `list_fields` 查看可用字段
2. 使用实际存在的字段名称
3. 或先创建字段再创建记录

---

## 测试完成后

### ✅ 所有测试通过

恭喜! Bitable 工具功能正常。您可以:

1. **在实际场景中使用**
   - 通过飞书机器人管理多维表格
   - 自动化数据录入和查询

2. **继续开发其他功能**
   - 开始 Calendar 工具开发
   - 或开始 Minutes 工具开发

3. **提供反馈**
   - 使用体验如何?
   - 有功能改进建议吗?
   - 文档是否清晰?

---

### ❌ 有测试失败

请告诉我:

1. **失败的测试名称**
2. **错误信息** (包含错误码)
3. **您的环境信息**
   - 飞书版本 (国内版/国际版)
   - 权限申请状态
   - app_token 格式

我会帮您分析和修复问题。

---

## 下一步

测试通过后，建议:

1. **阅读完整文档**
   - `skills/feishu-bitable/SKILL.md` - 详细使用指南
   - `BITABLE-TEST-GUIDE.md` - 完整测试指南

2. **尝试高级功能**
   - 使用过滤条件搜索
   - 批量创建大量数据
   - 创建复杂字段 (单选、多选)

3. **继续开发**
   - Calendar 工具 (日历和日程管理)
   - Minutes 工具 (飞书妙记)

---

**准备好了吗?** 🚀

运行 `node test-bitable.mjs` 开始测试!
