# Minutes 工具测试指南

## 快速开始

### 1. 准备测试环境

**获取妙记 Token**:
1. 在飞书中打开一个妙记
2. 从浏览器地址栏复制 URL
3. 提取 URL 中的 token

**URL 格式示例**:
```
https://nbwayine.feishu.cn/minutes/obcnj3B2NhPBOWb8lhFdTObqnXb
                                  └──────── 这是 token ────────┘
```

### 2. 运行测试

**PowerShell 中执行**:
```powershell
# 设置环境变量（已配置好 APP_ID 和 APP_SECRET）
$env:TEST_MINUTE_TOKEN = "your_minute_token_here"

# 运行测试
node test-minutes.mjs
```

### 3. 预期结果

**成功的情况**:
```
开始测试 Minutes 工具...

1️⃣ 获取妙记信息...
   Token: obcnj3B2NhPBOWb8lhFdTObqnXb
   ✅ 获取成功
   📝 妙记信息: {...}

2️⃣ 获取统计数据...
   ✅ 获取成功
   📊 统计信息: {...}

✅ 测试完成！
```

**API 不可用的情况**:
```
1️⃣ 获取妙记信息...
   ❌ 获取失败: 404
   💡 提示: 妙记 API 可能在您的飞书版本中不可用
```

---

## 测试用例

### 用例 1: 获取妙记信息

**操作**: 调用 `get` action

**预期**: 返回妙记的基本信息（标题、创建者、时间等）

**可能的错误**:
- **404**: API 不存在或 token 无效
- **99991663**: 权限不足（需要 `minutes:minutes:readonly`）
- **99991404**: 妙记不存在或已删除

### 用例 2: 获取统计数据

**操作**: 调用 `statistics` action

**预期**: 返回参会人数、时长等统计信息

**可能的错误**:
- **404**: 统计 API 不可用
- **99991663**: 需要额外权限或企业版功能

---

## 权限要求

### 必须权限

在飞书开放平台申请以下权限:

| 权限范围 | 权限名称 | 说明 |
|---------|---------|------|
| `minutes:minutes:readonly` | 查看妙记 | 读取妙记信息 |

### 权限申请步骤

1. 登录飞书开放平台
2. 进入应用详情
3. 点击"权限管理"
4. 搜索并添加 `minutes:minutes:readonly`
5. 提交审核（通常即时生效）

---

## 故障排除

### 问题 1: 404 错误

**现象**: `获取失败: 404`

**可能原因**:
1. 妙记 API 在您的飞书版本中不可用
2. Token 格式错误
3. 妙记已删除

**解决方案**:
1. 检查 token 是否从正确的 URL 复制
2. 尝试其他妙记的 token
3. 在飞书开放平台的 API 调试工具中测试
4. 确认您的飞书版本支持妙记 API

### 问题 2: 权限错误 (99991663)

**现象**: `权限不足`

**解决方案**:
1. 在飞书开放平台申请 `minutes:minutes:readonly` 权限
2. 等待权限审核通过（通常即时）
3. 重新运行测试

### 问题 3: Token 无效 (99991404)

**现象**: `妙记不存在`

**解决方案**:
1. 确认妙记未被删除
2. 检查 token 是否完整（27 个字符左右）
3. 尝试重新创建一个妙记并测试

---

## API 限制说明

### 只读限制

飞书妙记 API 目前**仅支持只读操作**:

| 操作 | 支持状态 |
|------|---------|
| 获取妙记信息 | ✅ 支持 |
| 获取统计数据 | ✅ 支持（可能需要企业版） |
| 创建妙记 | ❌ 不支持 |
| 编辑妙记 | ❌ 不支持 |
| 删除妙记 | ❌ 不支持 |
| 列出妙记 | ❌ 不支持 |

### 访问妙记内容

妙记的实际内容（文本、录音、视频）不在 Minutes API 中返回。

**如需访问妙记内容**:
1. 使用 `feishu_minutes` 获取妙记元信息
2. 从元信息中找到关联的文档 token
3. 使用 `feishu_doc` 工具查看文档内容

---

## 测试检查清单

测试前确认:
- [ ] 已设置 `FEISHU_APP_ID` 和 `FEISHU_APP_SECRET`
- [ ] 已申请 `minutes:minutes:readonly` 权限
- [ ] 已准备有效的妙记 token
- [ ] Token 格式正确（约 27 个字符）

测试中验证:
- [ ] 能否成功调用 `get` 获取妙记信息
- [ ] 能否成功调用 `statistics` 获取统计
- [ ] 404 错误是否有友好提示
- [ ] 权限错误是否有清晰说明

---

## 下一步

测试完成后:
1. 确认功能可用性（哪些 API 可用）
2. 记录测试结果
3. 更新文档说明（如有 API 限制）
4. 与文档工具配合测试（访问妙记内容）

---

**版本**: v1.0.0
**更新时间**: 2026-02-02
